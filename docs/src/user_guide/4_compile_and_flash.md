# Compile and flash!

In this section, you'll be able to compile your firmware and flash it to your microcontroller.

## Compile the firmware

To compile the firmware is easy, just run

```shell
cargo build --release
```

If you've done all the previous steps correctly, you can find your compiled firmware at `target/<your_target>/release` folder, whose name is your project's name or the name set in `Cargo.toml`'s `[[bin]]` section.

The firmware generated by Rust has no extension, which is actually an ELF file.

If you encountered any problems when compiling the firmware, please report it [here](https://github.com/HaoboGu/rmk/issues).

## Flash the firmware

The last step is to flash compiled firmware to your microcontroller. RMK supports flashing the firmware via uf2 bootloader or debug probe. 


### Use uf2 bootloader

By default, Rust firmware is an ELF file, so we have to do some extra steps converting it to uf2 format.

Because the [official uf2 repo](https://github.com/microsoft/uf2/blob/master/utils/uf2conv.py) doesn't provide a method which converts ELF to uf2, so we need to convert the ELF to `.hex` or `.bin` file first and then convert `.hex` or `.bin` file to uf2.

Luckily, Rust provides `cargo-binutil` which simplifies it. First you should install it:

```shell
cargo install cargo-binutils
rustup component add llvm-tools
```

Then you can use the following command to compile the RMK firmware and convert the compiled firmware to `.hex` or `.bin`:

```shell
# Compile and convert to a binary file
cargo objcopy --release -- -O binary rmk-52840.bin
# Compile and convert to a .hex file
cargo objcopy --release -- -O ihex rmk-52840.hex
```

You can use the commands above to instead of `cargo build --release`, getting `.hex` or `.bin` automatically.

The last step is getting uf2 file from `.hex` or `.bin`:

```
cd <PATH_TO_RMK>/scripts
# Convert .bin to .uf2
python uf2conv.py <PATH_TO_YOUR_BIN_FIRMWARE> -c -b 0x26000 -f <YOUR_CHIP_FAMILY> -o rmk.uf2 
# Convert .hex to .uf2
python uf2conv.py <PATH_TO_YOUR_HEX_FIRMWARE> -c -f <YOUR_CHIP_FAMILY> -o rmk.uf2 
```

where `CHIP_FAMILY` can be found in `uf2conv.py`. If you cannot find your chip in the supported list, please open an issue!

Note that when you're converting `.bin` to uf2, you should set the start addr using `-b` argument.

[Here](https://github.com/HaoboGu/rmk/tree/main/examples/use_config/nrf52840_ble#nicenano-support) is an example for using nice!nano and converting and flashing uf2 firmware. 

### Use debug probe

If you have a debug probe like [daplink](https://daplink.io/), [jlink](https://www.segger.com/products/debug-probes/j-link/) or [stlink](https://github.com/stlink-org/stlink)(stm32 only), things become much easier: connect it with your board and host, make sure you have installed [probe-rs](https://probe.rs/), then just run

```shell
cargo run --release
```

Then the command configured in `.cargo/config.toml` will be executed. The firmware will be flashed to your microcontroller and run automatically, yay!

For more configurations of RMK, you can check out feature documentations on the left.